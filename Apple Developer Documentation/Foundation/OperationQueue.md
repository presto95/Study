# OperationQueue

**클래스** | 오퍼레이션 실행을 규정하는 큐.

---

## 개요

오퍼레이션 큐는 큐에 들어간 `Operation` 오브젝트들을 그 우선 순위 및 준비 상태에 따라 실행한다. 오퍼레이션 큐에 추가된 이후, 그것은 작업을 완료했다고 보고하기까지 큐에 남아있는다. 오퍼레이션은 추가된 이후 직접적으로 큐에서 제거될 수 없다.

> 오퍼레이션 큐는 완료되기까지 오퍼레이션들을 보유하고 있으며, 큐 자체는 모든 오퍼레이션들이 완료되기까지 보유된다. 완료되지 않은 오퍼레이션을 가진 오퍼레이션 큐를 중지하는 것은 메모리 누수를 발생시킬 수 있다.

## 실행 순서 결정하기

큐 안에 있는 오퍼레이션들은 그 준비 상태, 우선 순위 수준, 오퍼레이션 간 의존성에 따라 구성되며, 그에 따라 실행된다. 대기 중인 모든 오퍼레이션들이 같은 `queuePriority`를 가지고 있고, 큐에 들어갈 때 실행될 준비가 되어 있다면--즉, `isReady` 프로퍼티가 `true`를 반환할 때--큐에 제출된 순서대로 오퍼레이션들은 실행된다. 그렇지 않으면, 오퍼레이션 큐는 다른 준비된 오퍼레이션들에 대하여 항상 가장 높은 우선 순위를 가진 것부터 실행한다.

그러나, 오퍼레이션의 특정 실행 순서를 확신하기 위해 큐의 의미론에 의존해서는 안되는데, 오퍼레이션의 준비 상태의 변화가 실행 순서를 바꿀 수 있기 때문이다. 오퍼레이션 간 의존성은 오퍼레이션들에 대한 절대적인 실행 순서를 제공하는데, 그러한 오퍼레이션들이 다른 오퍼레이션 큐에 위치할지라도 그렇다. 어떠한 오퍼레이션 오브젝트는 그것이 의존하는 모든 오퍼레이션들이 실행을 완료할 때까지 실행될 준비가 되어 있지 않다고 간주된다.

## 오퍼레이션 취소하기

오퍼레이션 큐의 작업을 완료하는 것은 오퍼레이션이 그 작업을 완료된 것으로 수행했다는 것을 의미하지는 않는다. 오퍼레이션은 또한 취소될 수도 있다. 오퍼레이션 오브젝트를 취소하는 것은 오브젝트를 큐에서 머무르게 하지만, 그 작업을 가능한 한 빠르게 취소해야 한다고 그 오브젝트에게 통지한다. 현재 실행 중인 오퍼레이션에 대하여, 이는 오퍼레이션 오브젝트의 작업 코드가 취소 상태를 확인해야 하고, 그것이 하고 있는 것을 중단하고, 그 자체를 완료된 것으로 표시한다는 것을 의미한다. 대기 중이지만 아직 실행 중이지 않은 오퍼레이션에 대하여, 큐는 오퍼레이션 오브젝트의 `start()` 메소드를 호출하여 취소 이벤트를 처리하고 그 자체를 완료된 것으로 표시할 수 있게 해야 한다.

> 오퍼레이션을 취소하는 것은 그 오퍼레이션이 가지고 있는 어떠한 의존성이라도 무시하는 결과를 가져올 수 있다. 이 행동은 큐가 최대한 빠르게 오퍼레이션의 `start()` 메소드를 실행하는 것을 가능하게 한다. 차례대로 `start()` 메소드는 오퍼레이션을 완료 상태로 옮겨 큐에서 제거될 수 있도록 한다.

## KVO를 준수하는 프로퍼티

`OperationQueue` 클래스는 키-값 코딩(KVC) 및 키-값 옵저빙(KVO)를 준수합니다. 원한다면 다음의 프로퍼티를 관찰하여 애플리케이션의 다른 부분에서 통제할 수 있습니다. 다음의 키 경로를 사용하여 프로퍼티들을 관찰하십시오.

- `operations` : 읽기 전용
- `operationCount` : 읽기 전용
- `maxConcurrentOperationCount` : 읽기 및 쓰기 가능
- `isSuspended` : 읽기 및 쓰기 가능
- `name` : 읽기 및 쓰기 가능

이러한 프로퍼티에 옵저버를 부착할 수 있을지라도, 애플리케이션의 UI의 요소에 바인딩하기 위해 코코아 바인딩을 사용해서는 안됩니다. UI와 연관된 코드는 앱의 메인 쓰레드에서만 실행되어야 합니다. 그러나, 오퍼레이션 큐와 관련된 KVO 알림은 어떠한 쓰레드에서도 발생할 수 있습니다.

## 쓰레드 안전

오브젝트에 대한 접근을 동기화하기 위해 추가적인 락을 생성하는 것보다는, 여러 개의 쓰레드에서 하나의 `OperationQueue` 오브젝트를 사용하는 것이 안전합니다.

오퍼레이션 큐는 그들의 오퍼레이션 실행을 초기화하기 위해 `Dispatch` 프레임워크를 사용합니다. 결과적으로, 오퍼레이션은 항상 개별 쓰레드에서 실행되며, 그것들이 동기 혹은 비동기로 지정되는 것과는 관계가 없습니다.

