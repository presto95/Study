# 앱의 생명 주기 관리하기

**아티클** 

앱이 포어그라운드 또는 백그라운드에 있을 때 시스템 노티피케이션에 응답하고, 중요한 다른 시스템 관련 이벤트를 처리하기

## 개요

앱의 현재 상태는 특정 타이밍에 어떠한 작업을 할 수 있고 할 수 없는지를 결정한다. 예를 들어 포어그라운드 앱은 사용자의 주의를 받으므로 CPU를 포함한 시스템 자원에 대한 우선권을 갖는다. 대조적으로 백그라운드 앱은 화면에 있지 않기 때문에 가능한 한 적은 작업을 수행해야 하며, 아무것도 하지 않는 것이 더욱 선호된다. 앱이 상태를 변경할 때 그에 따라 그것의 행위를 조정해야 한다.

앱의 상태가 변화할 때 UIKit은 적절한 델리게이트 객체의 메소드를 호출하여 당신에게 알림을 준다.

- iOS 13과 그 이후 버전에서 씬*scene* 기반 앱에서 생명 주기 이벤트에 응답하기 위해 `UISceneDelegate` 객체를 사용한다.
- iOS 12와 그 이전 버전에서 생명 주기 이벤트에 응답하기 위해 `UIApplicationDelegate` 객체를 사용한다.

> 알아두기. 앱에 씬 지원을 활성화한다면 iOS는 iOS 13과 그 이후 버전에서 항상 씬 델리게이트를 사용한다. iOS 12와 그 이전 버전에서 시스템은 앱 델리게이트를 사용한다.

## 씬 기반 생명 주기 이벤트에 응답하기

앱이 씬을 지원한다면 UIKit은 각각에 개별 생명 주기 이벤트를 전달한다. 하나의 씬은 디바이스에서 실행 중인 앱의 하나의 UI 인스턴스를 나타낸다. 사용자는 각각의 앱에 여러 개의 씬을 생성할 수 있고, 개별적으로 그것들을 보이거나 숨길 수 있다. 각각의 씬은 그 자신만의 생명 주기를 갖기 때문에 각각 다른 실행 상태를 가질 수 있다. 예를 들어 하나의 씬이 포어그라운드에 있는 바념ㄴ에 다른 것들은 백그라운드에 있거나 중지될 수 있다.

> 중요. 씬 지원은 사전 동의 기능이다. 기본적인 지원을 활성화하려면 앱의 `Info.plist` 파일에 Specifying the Scenes Your App Supports에 기술된 `UIApplicationSceneManifest` 키를 추가하라.

다음 그림은 씬에 대한 상태 전환을 보여준다. 사용자나 시스템이 앱에 새로운 씬을 요청할 때, UIKit은 그것을 생성하고 부착되지 않은*unattached* 상태로 둔다. 사용자가 요청한 씬은 빠르게 포어그라운드로 이동하여 화면에 나타난다. 시스템이 요청한 씬은 일반적으로 백그라운드로 이동하여 이벤트를 처리할 수 있게 된다. 예를 들어 시스템은 백그라운드에 씬을 실행하여 위치 이벤트를 처리할 수 있다. 사용자가 앱의 UI를 사라지게 할 때 UIKit은 관련 씬을 백그라운드 상태로 보내고 결국에는 중단된*suspended* 상태로 보낸다. UIKit은 그것의 자원을 돌려 받기 위해 언제든지 백그라운드 또는 중단된 씬의 연결을 끊을 수 있으며, 해당 씬을 부착되지 않은 상태로 되돌릴 수 있다.

다음의 작업을 수행하기 위해 씬 전환을 사용하라.

- UIKit이 앱에 씬을 연결할 때 씬의 초기 UI를 구성하고 씬이 필요로 하는 데이터를 불러오라.
- 포어그라운드-활성화 상태로 전환할 때 UI를 구성하고 사용자와 상호작용하기 위해 준비하라.
- 포어그라운드-활성화 상태를 떠나기 전에 데이터를 저장하고 앱의 행위를 덜게 하라.
- 백그라운드 상태에 진입하기 전에 중요한 작업을 마치고 가능한 한 많은 메모리를 해제하고 앱의 스냅샷을 준비하라.
- 씬 연결 해제시 씬과 관련된 공유 자원을 정리하라.
- 씬과 관련된 이벤트에 더하여, `UIApplicationDelegate` 객체를 사용하여 앱의 실행에 응답해야 한다.

## 앱 기반 생명 주기 이벤트에 응답하기

iOS 12와 그 이전 버전, 그리고 씬을 지원하지 않는 앱에서 UIKit은 `UIApplicationDelegate` 객체에 모든 생명 주기 이벤트를 전달한다. 앱 델리게이트는 각각의 화면에 나타나는 윈도우를 포함하여 앱의 모든 윈도우를 관리한다. 결과적으로 앱의 상태 전환은 외부 디스플레이의 컨텐츠를 포함하여 앱 전체의 UI에 영향을 끼친다.

다음의 그림은 앱 델리게이트 객체와 관련된 상태 전환을 보여준다. 실행 후에 시스템은 앱을 비활성화 또는 백그라운드 상태에 두며, 이는 UI가 화면에 나타나려 하는지에 따라 달린 것이다. 포어그라운드에서 실행될 때 시스템은 앱을 자동으로 활성화 상태로 전환한다. 이후에 상태는 앱이 종료될 때까지 활성화 상태와 백그라운드 상태 사이에서 변동된다.

다음의 작업을 수행하기 위해 앱 전환을 사용하라.

- 실행 시에 앱의 자료 구조와 UI를 초기화하라.
- 활성화 시에 UI 구성을 마치고 사용자와 상호작용할 준비를 하라.
- 비활성화 전에 데이터를 저장하고 앱의 행위를 덜게 하라.
- 백그라운드 상태에 진입하기 전에 중요한 작업을 마치고 가능한 한 많은 메모리를 해제하고 앱의 스냅샷을 준비하라.
- 종료 시에 즉시 모든 작업을 중단하고 공유 자원을 릴리즈하라.

## 다른 중요한 이벤트에 응답하기

생명 주기 이벤트를 처리하는 것에 더하여, 앱은 반드시 다음의 표에 있는 이벤트를 처리하기 위해 준비되어야 한다. `UIApplicationDelegate` 객체를 사용하여 이러한 이벤트 중 대부분을 처리하라. 어떠한 경우에는 노티피케이션을 사용하여 처리할 수 있으며, 이는 앱의 다른 부분에서 이것들에 응답할 수 있게 해준다.

|||
|---|---|
|메모리 경고|앱의 메모리 사용량이 너무 높을 때 받는다. 앱이 사용하는 메모리 양을 줄여라.|
|보호받는 데이터가 사용 가능/사용 불가능해짐|사용자가 디바이스를 잠그거나 잠금 해제할 때 받는다.|
|Handoff 작업|`NSUserActivity` 객체가 처리될 필요가 있을 때 받는다.|
|시간 변화|이동 통신사가 시간 갱신을 전달하는 것과 같은 몇몇 다른 시간 변화에 의해 받는다.|
|URL 열기|앱이 리소스를 열 필요가 있을 때 받는다.|