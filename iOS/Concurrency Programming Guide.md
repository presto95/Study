# 동시성 프로그래밍 가이드

## 소개

동시성*concurrency*는 같은 시간에 일어나는 여러 가지 것들에 대한 개념입니다. 멀티코어 CPU가 증가하고, 각 프로세서의 코어 개수가 증가할 것이라는 깨달음 속에서, 소프트웨어 개발자들은 그 이점을 취하기 위한 새로운 방법을 필요로 합니다. macOS와 iOS와 같은 운영체제들이 병렬적으로 다수의 프로그램을 실행할 수 있는 능력을 가졌다 할지라도, 그러한 프로그램 중 대부분은 백그라운드에서 실행되며 작은 연속적인 프로세서 타임을 요구하는 작업을 수행합니다. 사용자의 주의를 사로잡고 컴퓨터를 분주하게 하는 것은 현재의 포어그라운드 애플리케이션입니다. 애플리케이션이 할 일은 많지만 사용 가능한 코어 중 일부분만을 점유하고 있다면, 여분의 프로세싱 리소스를 낭비하는 것입니다.

과거에, 애플리케이션에 동시성을 도입하는 것은 하나 또는 그 이상의 추가적인 쓰레드의 생성을 요구했습니다. 불운하게도, 쓰레드 관련 코드를 작성하는 것은 도전적입니다. 쓰레드는 수동으로 관리되어야만 하는 저수준 도구입니다. 어떠한 애플리케이션이 현재 시스템의 부하와 기반 하드웨어에 기반하여 동적으로 바꿀 수 있는 최적의 쓰레드 개수가 주어질 때, 올바른 쓰레딩 솔루션을 구현하는 것은 성취하는 것이 불가능하지 않지만 극도로 어렵습니다. 게다가 일반적으로 쓰레드에 사용되는 동기화 매커니즘은 퍼포먼스가 나아질 것이라는 보장 없이, 소프트웨어 설계에 복잡함과 위험을 더합니다.

macOS와 iOS 모두 병렬적 작업의 실행에 대하여 전통적인 쓰레드 기반 시스템과 애플리케이션에서 발견할 수 있는 것보다 더욱 비동기적인 접근법을 채택합니다. 직접적으로 쓰레드를 생성하기보다는, 애플리케이션은 특정 작업을 정의하고 시스템이 그것을 수행하게 하기만 하면 됩니다. 시스템이 그 쓰레드를 관리하게 함으로써, 애플리케이션은 날것의*raw* 쓰레드에서는 가능하지 않은 수준의 확장성*scalability*을 얻습니다. 애플리케이션 개발자들은 또한 더욱 단순하고 능률적인 프로그래밍 모델을 얻게 됩니다.

이 문서는 당신의 애플리케이션에 동시성을 구현하기 위해 사용해야 하는 테크닉과 기술에 대해 기술합니다. 이 문서에 기술된 기술은 macOS 및 iOS 모두에서 사용 가능합니다.

## 구성

이 문서는 다음의 챕터를 포함합니다.

- **동시성 및 애플리케이션 설계**는 비동기 애플리케이션 설계의 기본과, 커스텀 작업을 비동기적으로 수행하기 위한 기술을 소개합니다.
- **작업 큐*Operation Queue***는 Objective-C 옵젝트를 사용하여 작업을 캡슐화하고 수행하는 방법을 보여줍니다.
- **디스패치 큐*Dispatch Queue***는 C 기반 애플리케이션에서 동시적으로 작업을 수행하는 방법을 보여줍니다.
- **디스패치 소스*Dispatch Source***는 시스템 이벤트를 비동기적으로 처리하는 방법을 보여줍니다.
- **쓰레드 너머 마이그레이션하기*Migrating Away from Threads***는 존재하는 쓰레드 기반 코드를 새로운 기술을 사용하여 마이그레이션하기 위한 팁과 테크닉을 제공합니다.

또한 이 문서는 관련 용어를 정의한 용어 사전을 포함합니다.

## 전문 용어에 대한 노트

동시성에 대한 논의에 들어가기 전에, 혼란을 막기 위해 몇몇 관련 전문 용어를 정의하는 것이 필수적입니다. UNIX 시스템과 오래된 macOS 기술에 더 익숙한 개발자들은 "작업*task*", "프로세스*process*", "쓰레드*thread*"와 같은, 이 문서에서 다른 의미로 사용되는 용어를 발견할 것입니다. 이 문서는 다음의 방식으로 이러한 용어를 사용합니다.

- *쓰레드*는 코드 실행의 분리된 길*a separate path of execution of code*을 언급할 때 사용됩니다. macOS의 쓰레드 구현에 깔려 있는 것은 POSIX 쓰레드 API에 기반합니다.
- *프로세스*는 여러 개의 쓰레드로 감싸질 수 있는, 실행 중인 실행 프로그램*a running executable*을 언급할 때 사용됩니다.
- *작업*은 수행될 필요가 있는 작업의 추상적 개념을 언급할 때 사용됩니다.

## 함께 살펴보기

이 문서는 애플리케이션에서 동시성을 구현하기 위해 선호되는 기술에 초점을 두며, 쓰레드 사용에 대해서는 다루지 않습니다. 쓰레드 사용 및 다른 쓰레드와 관련된 기술에 대한 정보가 필요하다면 쓰레딩 프로그래밍 가이드를 참고하십시오.

---

# 동시성 및 애플리케이션 디자인

컴퓨팅 초기에, 컴퓨터가 수행할 수 있는 시간당 작업의 최대 개수는 CPU의 클록 속도에 의해 결정되었습니다. 하지만 기술이 발전하고 프로세서 설계가 더욱 집약되면서, 열과 다른 물리적 제약이 프로세세의 최대 클록 속도를 제한하기 시작했습니다. 그래서 칩 제조자들은 칩의 총 퍼포먼스를 늘리기 위한 다른 방법을 찾았습니다. 그들이 확정한 솔루션은 각 칩에 프로세세 코어의 개수를 늘리는 것이었습니다. 코어 개수를 늘려서, 하나의 칩은 CPU 속도를 증가시키거나 칩 크기나 열과 관련된 특성을 변경하지 않고서 초당 더 많은 명령어를 수행할 수 있었습니다. 유일한 문제는, 어떻게 여분의 코어의 이점을 취하냐는 것이었습니다.

다수의 코어의 이점을 취하기 위해, 컴퓨터는 동시에 많은 것을 할 수 있는 소프트웨어를 필요로 합니다. 현대에 들어서, macOS나 iOS와 같은 멀티태스킹 운영체제에는 주어진 시간에 백 개 이상의 프로그램이 동작하고 있으며, 각 프로그램을 다른 코어에 스케줄링하는 것이 가능해야 합니다. 그러나 이러한 프로그램 중 대부분은 매우 적은 실제 프로세싱 시간을 소비하는 시스템 데몬이거나 백그라운드 애플리케이션입니다. 대신, 정말로 필요한 것은 별개의 애플리케이션이 여분의 코어를 더 효과적으로 사용하게 하는 방법입니다.

애플리케이션이 다수의 코어를 사용하는 전통적인 방법은 여러 개의 쓰레드를 생성하는 것입니다. 그러나, 코어의 개수가 증가하면서, 쓰레드와 관련된 솔루션에 문제가 발생했습니다. 가장 큰 문제는 쓰레드 관련 코드는 임의의 코어 개수에 따라 잘 확장되지 않는다는 것입니다. 코어의 개수, 프로그램이 잘 동작할 것이라고 기대되는 것보다 많은 쓰레드를 생성할 수 없습니다. 당신이 알 필요가 있는 것은 능률적으로 사용될 수 있는 코어의 개수인데, 그 자신을 계산하는 것은 도전적인 것입니다. 어떻게든 그 개수를 올바르게 구했다고 할지라도, 매우 많은 쓰레드에 대한 도전적인 프로그래밍 문제가 남아 있습니다. 그것들을 능률적으로 동자갛게 해야 하고, 각각의 것을 서로 간섭하지 않도록 해야 합니다.

요약하자면, 애플리케이션이 일정하지 않은 컴퓨터 코어의 개수에 대한 이점을 취하는 방법이 필요합니다. 하나의 애플리케이션에 의해 수행되는 작업의 양은 변화하는 시스템 상태에 적응하기 위해 동적으로 변화할 필요가 있습니다. 그리고 코어의 이점을 취하기 위해 필요한 